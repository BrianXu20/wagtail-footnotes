[tox]
envlist =
    py{38}-dj{22,30,31}-wagtail{29,210,211,212,213}
    py{38}-dj{22,30,31,32}-wagtail{213}
    flake8
    isort
    black

[testenv]
setenv =
    PYTHONPATH = {toxinidir}
    DJANGO_SETTINGS_MODULE = wagtail_footnotes_test_app.settings
deps =
    faker
    wagtail_factories
    coverage
    dj22: Django>=2.2,<2.3
    dj30: Django>=3.0,<3.1
    dj31: Django>=3.1,<3.2
    dj32: Django>=3.2,<3.3
    wagtail28: wagtail>=2.8,<2.9
    wagtail29: wagtail>=2.9,<2.10
    wagtail210: wagtail>=2.10,<2.11
    wagtail211: wagtail>=2.11,<2.12
    wagtail212: wagtail>=2.12,<2.13
    wagtail213: wagtail>=2.13,<2.14
    ; wagtailmaster: git+https://github.com/wagtail/wagtail.git@main#egg=Wagtail

install_command = pip install -U {opts} {packages}
commands =
    coverage run --source="{toxinidir}/wagtail_footnotes" -m django test wagtail_footnotes_test_app wagtail_footnotes
    django-admin check
    django-admin makemigrations --check --noinput
    coverage report -m --omit="{toxinidir}/wagtail_footnotes_test_app/tests/*" --omit="{toxinidir}/wagtail_footnotes/tests/*" --fail-under=80
extras = testing

[testenv:black]
basepython = python3
commands =
    black --check ./

[testenv:flake8]
basepython = python3
commands =
    flake8 wagtail_footnotes

[testenv:isort]
basepython = python3
usedevelop = false
changedir = {toxinidir}
commands =
    isort --recursive --check-only --diff wagtail_footnotes
